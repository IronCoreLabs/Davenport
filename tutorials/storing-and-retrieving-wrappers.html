<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/Article">
  <head>
          <!-- META META 1 -->

    
      
      
    

    

    

    
    

    
      
    

    <title>Storing and Retrieving Case Classes - Davenport</title>

  <!-- The important stuff -->
    <meta charset="utf-8" >
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/davenport/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/davenport/favicon.ico" type="image/x-icon">



  
    <meta name="description" content="Davenport brings Free Monads to interactions with Couchbase. You don't need to know or understand what these are as they can remain under the hood. The key takeaway is that you assemble together a set of functions and database operations, but you delay execution of this. When you're ready, you pass the set of instructions to a connection. We currently support an in-memory Map and Couchbase as connections. This makes testing and reasoning about your database operations far simpler.">
  




    <link rel="stylesheet" href="/davenport/css/styles.css">
  </head>
  <body>
    <nav class="container" role="navigation">
  <div>
    <a href="/davenport">Davenport</a>
  </div>
  
  <ul>
    
    <li ><a href="https://github.com/IronCoreLabs/davenport">Github</a></li>
    
    <li ><a href="/davenport/latest/api">Scaladocs</a></li>
    
    <li class="active"><a href="/davenport/tutorials/getting-started.html">Tutorials</a></li>
    
    <li ><a href="/davenport/">Overview</a></li>
    
  </ul>
</nav>



    <div class="container subnav">
  <nav>
    <ul>
      
      
        <li >
          <a href="/davenport/tutorials/free-grammar-usage.html">Free Grammar Implementation</a>
        </li>
      
        <li >
          <a href="/davenport/tutorials/getting-started.html">Getting Started</a>
        </li>
      
        <li class="active">
          <a href="/davenport/tutorials/storing-and-retrieving-wrappers.html">Storing and Retrieving Case Classes</a>
        </li>
      
    </ul>
  </nav>
</div>
<div class="container">
  <article class="page">
    <h1>Storing and Retrieving Case Classes</h1>

    <div class="entry">
      <p>Suppose you have a User class that has some basic fields:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>case class User(firstName: String, lastName: String, email: String, createdDate: Long)
</pre></div>
</div>
</div>

<p>We prefer not to adulterate the underlying class. All you need to write is the <code>JsonCodec</code> and a way to generate the <code>Key</code> for your type. In our example, we’ll put the <code>createKey</code> function on the companion object, but it could be located anywhere.</p>

<p>First, the data type definition:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>import com.ironcorelabs.davenport.DB.Key
import argonaut._, Argonaut._

object Example {
  case class User(firstName: String, lastName: String, email: String, createdDate: Long)
  
  object User{
    implicit def codec: CodecJson[User] = casecodec4(User.apply, User.unapply)(&quot;firstName&quot;, &quot;lastName&quot;, &quot;email&quot;, &quot;createdDate&quot;)
    def createKey(u: User): Key = Key(s&quot;user::${u.email}&quot;)
  }
}
</pre></div>
</div>
</div>

<p>Now that we have a <code>JsonCodec</code> and a way to get a key, let’s see how it works!</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>scala&gt; import Example._
import Example._

scala&gt; import com.ironcorelabs.davenport.datastore.MemDatastore
import com.ironcorelabs.davenport.datastore.MemDatastore

scala&gt; import com.ironcorelabs.davenport.syntax._
import com.ironcorelabs.davenport.syntax._

scala&gt; import scalaz._
import scalaz._

scala&gt; val user1 = User(&quot;User&quot;, &quot;One&quot;, &quot;readyplayerone@example.com&quot;, System.currentTimeMillis())
user1: Example.User = User(User,One,readyplayerone@example.com,1447818541661)

scala&gt; val user2 = User(&quot;User&quot;, &quot;Two&quot;, &quot;readyplayertwo@example.com&quot;, System.currentTimeMillis())
user2: Example.User = User(User,Two,readyplayertwo@example.com,1447818541791)

scala&gt; val addTwoNewUsers = for {
     |   newu1 &lt;- User.createKey(user1).dbCreate(user1)
     |   newu2 &lt;- User.createKey(user2).dbCreate(user2)
     | } yield List(newu1, newu2)
addTwoNewUsers: scalaz.EitherT[com.ironcorelabs.davenport.DB.DBOps,com.ironcorelabs.davenport.DB.DBError,List[com.ironcorelabs.davenport.DBDocument[Example.User]]] = EitherT(Gosub())

scala&gt; val users = MemDatastore.empty.execute(addTwoNewUsers).run
users: scalaz.\/[com.ironcorelabs.davenport.DB.DBError,List[com.ironcorelabs.davenport.DBDocument[Example.User]]] = \/-(List(DBDocument(Key(user::readyplayerone@example.com),CommitVersion(578477239),User(User,One,readyplayerone@example.com,1447818541661)), DBDocument(Key(user::readyplayertwo@example.com),CommitVersion(-2125049027),User(User,Two,readyplayertwo@example.com,1447818541791))))
</pre></div>
</div>
</div>

<p>Feel free to test against Couchbase as well.  We’ll keep illustrating with the MemDatastore for now to show how you can easily experiment and write unit tests.  As an alternative to calling <code>MemDatastore.empty.execute</code> you can call <code>CouchConnection.createInterpreter.execute</code>.  You could also import the syntax which will add <code>execute</code> to <code>DBProg</code> which takes any <code>Interpreter</code>. Building on our example above, we could instead do this:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>scala&gt; val datastore = MemDatastore.empty
datastore: com.ironcorelabs.davenport.datastore.MemDatastore = com.ironcorelabs.davenport.datastore.MemDatastore$$anon$1@3fdd5104

scala&gt; val users = addTwoNewUsers.execute(datastore).run
users: scalaz.\/[com.ironcorelabs.davenport.DB.DBError,List[com.ironcorelabs.davenport.DBDocument[Example.User]]] = \/-(List(DBDocument(Key(user::readyplayerone@example.com),CommitVersion(578477239),User(User,One,readyplayerone@example.com,1447818541661)), DBDocument(Key(user::readyplayertwo@example.com),CommitVersion(-2125049027),User(User,Two,readyplayertwo@example.com,1447818541791))))

scala&gt; // Fetch one of the users out of the database
     | val u1 = Key(&quot;user::readyplayerone@example.com&quot;).dbGet[User].execute(datastore).run
u1: scalaz.\/[com.ironcorelabs.davenport.DB.DBError,com.ironcorelabs.davenport.DBDocument[Example.User]] = \/-(DBDocument(Key(user::readyplayerone@example.com),CommitVersion(578477239),User(User,One,readyplayerone@example.com,1447818541661)))
</pre></div>
</div>
</div>

    </div>
  </article>
</div>


    
    <footer class="container center-text">
            Copyright &copy;
            <time datetime="2015">2015</time>
            IronCore Labs, Inc.
            All rights reserved.
    </footer>




    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script> -->
    <script src="/davenport/js/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script>
      hljs.configure({
        tabReplace: '    ', // 4 spaces
        languages: ['scala', 'json', 'bash']
      });
      var smallblocks = document.getElementsByTagName("code");
      var bigblocks = document.getElementsByClassName("code");
      _.each(smallblocks, hljs.highlightBlock);
      _.each(bigblocks, hljs.highlightBlock);
    </script>
  </body>
</html>
